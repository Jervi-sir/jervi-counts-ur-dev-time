{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://jervi-counts-ur-dev-time/./src/config.ts","webpack://jervi-counts-ur-dev-time/./src/sync.ts","webpack://jervi-counts-ur-dev-time/external commonjs \"vscode\"","webpack://jervi-counts-ur-dev-time/./src/auth.ts","webpack://jervi-counts-ur-dev-time/webpack/bootstrap","webpack://jervi-counts-ur-dev-time/./src/extension.ts"],"sourcesContent":["// config.ts\r\n// Configuration for Supabase Edge Function\r\n\r\nexport const SUPABASE_CONFIG = {\r\n  // Configured for deployed edge function\r\n  url: \"https://zdofgzagbuyytgnesfgw.supabase.co\",\r\n\r\n  // Supabase anon key\r\n  anonKey: \"sb_publishable_YElI4wwyRFBzjNY_Wt7H-A_HCZqeJrI\",\r\n\r\n  // The Edge Function endpoint\r\n  edgeFunctionName: \"pushToDb\"\r\n};\r\n\r\n// Sync interval in milliseconds (14 minutes)\r\nexport const SYNC_INTERVAL_MS = 14 * 60 * 1000;\r\n\r\n// Storage keys\r\nexport const STORAGE_KEYS = {\r\n  DAILY: \"ctc.dailyTotals\",\r\n  DAILY_TOTAL: \"ctc.dailyTotalSeconds\", // Total time (regardless of focus)\r\n  ENABLED: \"ctc.enabled\",\r\n  PROJECT: \"ctc.projectTotal\",\r\n  PENDING_SYNC: \"ctc.pendingSync\",\r\n  LANGUAGE_TOTALS: \"ctc.languageTotals\",\r\n  USER_ID: \"ctc.userId\",\r\n  USER_EMAIL: \"ctc.userEmail\",\r\n  LAST_SYNC: \"ctc.lastSync\"\r\n};\r\n","// sync.ts\r\n// Handles syncing data to Supabase Edge Function\r\n\r\nimport * as vscode from \"vscode\";\r\nimport { SUPABASE_CONFIG, STORAGE_KEYS } from \"./config\";\r\nimport { SyncPayload, PendingSyncData, LanguageTotals } from \"./types\";\r\n\r\n/**\r\n * Build the sync payload from accumulated data\r\n */\r\nexport function buildSyncPayload(\r\n  username: string,\r\n  dailyTotals: Record<string, number>,\r\n  dailyTotalSeconds: Record<string, number>,\r\n  languageTotals: LanguageTotals\r\n): SyncPayload {\r\n  const data: PendingSyncData[] = [];\r\n\r\n  // Get all unique days from both focused and total seconds\r\n  const allDays = new Set([\r\n    ...Object.keys(dailyTotals),\r\n    ...Object.keys(dailyTotalSeconds)\r\n  ]);\r\n\r\n  // Iterate through each day that has data\r\n  for (const day of allDays) {\r\n    const focusedSeconds = dailyTotals[day] || 0;\r\n    const totalSeconds = dailyTotalSeconds[day] || 0;\r\n\r\n    // Only sync if there's any time recorded\r\n    if (focusedSeconds > 0 || totalSeconds > 0) {\r\n      const languageBreakdown = languageTotals[day] || {};\r\n\r\n      data.push({\r\n        day,\r\n        focusedSeconds,\r\n        totalSeconds,\r\n        languageBreakdown,\r\n        source: \"vscode\"\r\n      });\r\n    }\r\n  }\r\n\r\n  return {\r\n    username,\r\n    data\r\n  };\r\n}\r\n\r\n/**\r\n * Send data to Supabase Edge Function\r\n */\r\nexport async function syncToSupabase(\r\n  context: vscode.ExtensionContext,\r\n  username: string\r\n): Promise<boolean> {\r\n  try {\r\n    // Get accumulated data\r\n    const dailyTotals = context.globalState.get<Record<string, number>>(STORAGE_KEYS.DAILY, {});\r\n    const dailyTotalSeconds = context.globalState.get<Record<string, number>>(STORAGE_KEYS.DAILY_TOTAL, {});\r\n    const languageTotals = context.globalState.get<LanguageTotals>(STORAGE_KEYS.LANGUAGE_TOTALS, {});\r\n\r\n    // Build payload\r\n    const payload = buildSyncPayload(username, dailyTotals, dailyTotalSeconds, languageTotals);\r\n\r\n    // Skip if no data to sync\r\n    if (payload.data.length === 0) {\r\n      console.log('No data to sync');\r\n      return true;\r\n    }\r\n\r\n    // Construct Edge Function URL\r\n    // Construct Edge Function URL\r\n    const edgeFunctionUrl = `${SUPABASE_CONFIG.url}/functions/v1/${SUPABASE_CONFIG.edgeFunctionName}`;\r\n\r\n    console.log(`[Sync] Target: ${edgeFunctionUrl}`);\r\n    console.log(`[Sync] Payload size: ${payload.data.length} days for user: ${username}`);\r\n    console.log(JSON.stringify(payload, null, 2)); // Now enabled for debugging \r\n\r\n    // Send to Supabase Edge Function\r\n    const response = await fetch(edgeFunctionUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${SUPABASE_CONFIG.anonKey}`\r\n      },\r\n      body: JSON.stringify(payload)\r\n    });\r\n\r\n    const responseText = await response.text();\r\n\r\n    if (!response.ok) {\r\n      console.error(`[Sync] Failed: ${response.status} ${response.statusText}`);\r\n      console.error(`[Sync] Response Body: ${responseText}`);\r\n      throw new Error(`Sync failed: ${response.status} - ${responseText}`);\r\n    }\r\n\r\n    console.log(`[Sync] Success! Response: ${responseText}`);\r\n    const result = JSON.parse(responseText);\r\n    console.log('Sync successful:', result);\r\n\r\n    // Update last sync timestamp\r\n    await context.globalState.update(STORAGE_KEYS.LAST_SYNC, Date.now());\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Sync error:', error);\r\n    vscode.window.showErrorMessage(`Failed to sync: ${error instanceof Error ? error.message : String(error)}`);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the last sync timestamp\r\n */\r\nexport function getLastSyncTime(context: vscode.ExtensionContext): number {\r\n  return context.globalState.get<number>(STORAGE_KEYS.LAST_SYNC, 0);\r\n}\r\n\r\n/**\r\n * Format last sync time for display\r\n */\r\nexport function formatLastSync(timestamp: number): string {\r\n  if (timestamp === 0) {\r\n    return \"Never\";\r\n  }\r\n\r\n  const now = Date.now();\r\n  const diff = now - timestamp;\r\n  const minutes = Math.floor(diff / 60000);\r\n\r\n  if (minutes < 1) {\r\n    return \"Just now\";\r\n  } else if (minutes < 60) {\r\n    return `${minutes} min ago`;\r\n  } else {\r\n    const hours = Math.floor(minutes / 60);\r\n    return `${hours}h ${minutes % 60}m ago`;\r\n  }\r\n}\r\n","module.exports = require(\"vscode\");","// auth.ts\r\n// Authentication utilities for getting VSCode user identity\r\n\r\nimport * as vscode from \"vscode\";\r\nimport { AuthUser } from \"./types\";\r\n\r\n/**\r\n * Get the authenticated user from VSCode\r\n * Tries GitHub, Microsoft, then Google in that order\r\n * Forces GitHub login if none found\r\n */\r\nexport async function getAuthenticatedUser(): Promise<AuthUser | null> {\r\n  try {\r\n    // Helper to extract username from label (which might be email)\r\n    const extractUsername = (label: string): string => {\r\n      if (label.includes('@')) {\r\n        return label.split('@')[0];\r\n      }\r\n      return label;\r\n    };\r\n\r\n    // 1. Try GitHub first (most common for developers)\r\n    try {\r\n      const ghSession = await vscode.authentication.getSession('github', ['read:user'], { createIfNone: false });\r\n      if (ghSession) {\r\n        return {\r\n          id: ghSession.account.id,\r\n          username: ghSession.account.label, // GitHub label is usually username\r\n          email: ghSession.account.label, // Might not be email, but used for display\r\n          provider: 'github'\r\n        };\r\n      }\r\n    } catch (e) {\r\n      console.log('GitHub auth not available');\r\n    }\r\n\r\n    // 2. Try Microsoft (built-in to VSCode)\r\n    try {\r\n      const msSession = await vscode.authentication.getSession('microsoft', ['User.Read'], { createIfNone: false });\r\n      if (msSession) {\r\n        return {\r\n          id: msSession.account.id,\r\n          username: extractUsername(msSession.account.label),\r\n          email: msSession.account.label,\r\n          provider: 'microsoft'\r\n        };\r\n      }\r\n    } catch (e) {\r\n      console.log('Microsoft auth not available');\r\n    }\r\n\r\n    // 3. Try Google\r\n    try {\r\n      const googleSession = await vscode.authentication.getSession('google', ['profile', 'email'], { createIfNone: false });\r\n      if (googleSession) {\r\n        return {\r\n          id: googleSession.account.id,\r\n          username: extractUsername(googleSession.account.label),\r\n          email: googleSession.account.label,\r\n          provider: 'google'\r\n        };\r\n      }\r\n    } catch (e) {\r\n      console.log('Google auth not available');\r\n    }\r\n\r\n    // 4. Force GitHub login if nothing found\r\n    const session = await vscode.authentication.getSession('github', ['read:user'], { createIfNone: true });\r\n    if (session) {\r\n      return {\r\n        id: session.account.id,\r\n        username: session.account.label,\r\n        email: session.account.label,\r\n        provider: 'github'\r\n      };\r\n    }\r\n\r\n    return null;\r\n  } catch (e) {\r\n    console.error('Error getting authenticated user:', e);\r\n    vscode.window.showErrorMessage(`Failed to authenticate: ${e instanceof Error ? e.message : String(e)}`);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Ensure user is authenticated, show error if not\r\n */\r\nexport async function ensureAuthenticated(): Promise<AuthUser | null> {\r\n  const user = await getAuthenticatedUser();\r\n  if (!user) {\r\n    vscode.window.showErrorMessage('Please sign in to track your coding time. Use Command Palette: \"Sign in to sync settings\"');\r\n  }\r\n  return user;\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import * as vscode from \"vscode\";\nimport { STORAGE_KEYS, SYNC_INTERVAL_MS } from \"./config\";\nimport { ExtensionState, DailyTotals, LanguageTotals } from \"./types\";\nimport { getAuthenticatedUser, ensureAuthenticated } from \"./auth\";\nimport { syncToSupabase, getLastSyncTime, formatLastSync } from \"./sync\";\n\nfunction dayKey(d = new Date()) {\n\tconst y = d.getFullYear();\n\tconst m = String(d.getMonth() + 1).padStart(2, \"0\");\n\tconst dd = String(d.getDate()).padStart(2, \"0\");\n\treturn `${y}-${m}-${dd}`;\n}\n\nfunction formatHMS(totalSeconds: number) {\n\tconst s = Math.max(0, Math.floor(totalSeconds));\n\tconst h = Math.floor(s / 3600);\n\tconst m = Math.floor((s % 3600) / 60);\n\tconst ss = s % 60;\n\treturn `${String(h).padStart(2, \"0\")}:${String(m).padStart(2, \"0\")}:${String(ss).padStart(2, \"0\")}`;\n}\n\nexport function activate(context: vscode.ExtensionContext) {\n\tconst status = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Left, 100);\n\tstatus.command = \"ctc.toggleTracking\";\n\tstatus.tooltip = \"Code Time Counter (click to toggle)\";\n\tstatus.show();\n\n\tconst state: ExtensionState = {\n\t\tenabled: context.globalState.get<boolean>(STORAGE_KEYS.ENABLED, true),\n\t\tlastTickAt: Date.now(),\n\t\tlastDayKey: dayKey(),\n\t\tfocused: vscode.window.state.focused,\n\t\tcurrentLanguage: vscode.window.activeTextEditor?.document.languageId || null,\n\t\tlastSyncAt: getLastSyncTime(context)\n\t};\n\n\t// Initialize authentication on startup\n\t// We now only store USER_ID (the username) for display/sync\n\tlet username: string | null = context.globalState.get<string>(STORAGE_KEYS.USER_ID) || null;\n\n\t// Helper Functions\n\tfunction readDailyTotals(): DailyTotals {\n\t\treturn context.globalState.get<DailyTotals>(STORAGE_KEYS.DAILY, {});\n\t}\n\n\tasync function writeDailyTotals(totals: DailyTotals) {\n\t\tawait context.globalState.update(STORAGE_KEYS.DAILY, totals);\n\t}\n\n\tfunction readDailyTotalSeconds(): DailyTotals {\n\t\treturn context.globalState.get<DailyTotals>(STORAGE_KEYS.DAILY_TOTAL, {});\n\t}\n\n\tasync function writeDailyTotalSeconds(totals: DailyTotals) {\n\t\tawait context.globalState.update(STORAGE_KEYS.DAILY_TOTAL, totals);\n\t}\n\n\tfunction readLanguageTotals(): LanguageTotals {\n\t\treturn context.globalState.get<LanguageTotals>(STORAGE_KEYS.LANGUAGE_TOTALS, {});\n\t}\n\n\tasync function writeLanguageTotals(totals: LanguageTotals) {\n\t\tawait context.globalState.update(STORAGE_KEYS.LANGUAGE_TOTALS, totals);\n\t}\n\n\tasync function addSecondsToToday(seconds: number) {\n\t\tif (seconds <= 0) return;\n\n\t\tconst today = dayKey();\n\t\tconst totals = readDailyTotals();\n\t\ttotals[today] = (totals[today] ?? 0) + seconds;\n\t\tawait writeDailyTotals(totals);\n\t}\n\n\tasync function addTotalSecondsToToday(seconds: number) {\n\t\tif (seconds <= 0) return;\n\n\t\tconst today = dayKey();\n\t\tconst totals = readDailyTotalSeconds();\n\t\ttotals[today] = (totals[today] ?? 0) + seconds;\n\t\tawait writeDailyTotalSeconds(totals);\n\t}\n\n\tasync function addSecondsToLanguage(language: string | null, seconds: number) {\n\t\tif (seconds <= 0 || !language) return;\n\n\t\tconst today = dayKey();\n\t\tconst totals = readLanguageTotals();\n\n\t\tif (!totals[today]) {\n\t\t\ttotals[today] = {};\n\t\t}\n\n\t\ttotals[today][language] = (totals[today][language] ?? 0) + seconds;\n\t\tawait writeLanguageTotals(totals);\n\t}\n\n\tfunction getTodaySeconds() {\n\t\tconst totals = readDailyTotals();\n\t\treturn totals[dayKey()] ?? 0;\n\t}\n\n\tfunction getProjectSeconds() {\n\t\treturn context.workspaceState.get<number>(STORAGE_KEYS.PROJECT, 0);\n\t}\n\n\tasync function addSecondsToProject(seconds: number) {\n\t\tif (seconds <= 0) return;\n\t\tconst current = getProjectSeconds();\n\t\tawait context.workspaceState.update(STORAGE_KEYS.PROJECT, current + seconds);\n\t}\n\n\tfunction setStatusText() {\n\t\tconst tProject = getProjectSeconds();\n\t\tconst tToday = getTodaySeconds();\n\t\tconst icon = state.enabled ? \"⏱\" : \"⏸\";\n\t\tconst syncIcon = username ? \"☁\" : \"⚠\";\n\n\t\t// Display Project Time in the status bar\n\t\tstatus.text = `${icon} ${formatHMS(tProject)} ${syncIcon}`;\n\n\t\t// Detailed tooltip\n\t\tconst lastSync = formatLastSync(state.lastSyncAt);\n\t\tconst authStatus = username ? `Signed in as: ${username}` : \"Not signed in\";\n\n\t\tstatus.tooltip = state.enabled\n\t\t\t? `Tracking ON (click to pause)\\n\\nProject Total: ${formatHMS(tProject)}\\nToday Total: ${formatHMS(tToday)}\\n\\n${authStatus}\\nLast Sync: ${lastSync}`\n\t\t\t: `Tracking OFF (click to resume)\\n\\nProject Total: ${formatHMS(tProject)}\\nToday Total: ${formatHMS(tToday)}\\n\\n${authStatus}\\nLast Sync: ${lastSync}`;\n\t}\n\n\tasync function rollDayIfNeeded() {\n\t\tconst nowKey = dayKey();\n\t\tif (nowKey !== state.lastDayKey) {\n\t\t\t// day changed; just update reference\n\t\t\tstate.lastDayKey = nowKey;\n\t\t}\n\t}\n\n\tasync function tick() {\n\t\tconst now = Date.now();\n\t\tconst elapsedSec = Math.floor((now - state.lastTickAt) / 1000);\n\t\tstate.lastTickAt = now;\n\n\t\tawait rollDayIfNeeded();\n\n\t\tif (state.enabled && elapsedSec > 0) {\n\t\t\t// Always count total seconds (regardless of focus)\n\t\t\tawait addTotalSecondsToToday(elapsedSec);\n\n\t\t\t// Count focused seconds only when VS Code window is focused\n\t\t\tif (state.focused) {\n\t\t\t\tawait addSecondsToToday(elapsedSec);\n\t\t\t\tawait addSecondsToProject(elapsedSec);\n\t\t\t\tawait addSecondsToLanguage(state.currentLanguage, elapsedSec);\n\t\t\t}\n\t\t}\n\n\t\tsetStatusText();\n\t}\n\n\tasync function performSync() {\n\t\tif (!username) {\n\t\t\tconsole.log('Skipping sync: user not authenticated');\n\t\t\treturn;\n\t\t}\n\n\t\tconst success = await syncToSupabase(context, username);\n\t\tif (success) {\n\t\t\tstate.lastSyncAt = Date.now();\n\t\t\tsetStatusText();\n\t\t}\n\t}\n\n\t// Initialize user authentication\n\t(async () => {\n\t\tconst user = await getAuthenticatedUser();\n\t\tif (user) {\n\t\t\tusername = user.username;\n\t\t\t// Store for persistence\n\t\t\tawait context.globalState.update(STORAGE_KEYS.USER_ID, username);\n\n\t\t\tconsole.log(`Authenticated as: ${username} (${user.provider})`);\n\n\t\t\t// Perform initial sync\n\t\t\tawait performSync();\n\t\t} else {\n\t\t\tconsole.log('User not authenticated - tracking locally only');\n\t\t}\n\t\tsetStatusText();\n\t})();\n\n\t// Initial paint\n\tsetStatusText();\n\n\t// Track active editor language changes\n\tcontext.subscriptions.push(\n\t\tvscode.window.onDidChangeActiveTextEditor((editor) => {\n\t\t\tstate.currentLanguage = editor?.document.languageId || null;\n\t\t})\n\t);\n\n\t// Track focus changes\n\tcontext.subscriptions.push(\n\t\tvscode.window.onDidChangeWindowState((e) => {\n\t\t\tstate.focused = e.focused;\n\t\t\t// reset tick baseline to avoid counting idle gap\n\t\t\tstate.lastTickAt = Date.now();\n\t\t\tsetStatusText();\n\t\t})\n\t);\n\n\t// 1-second heartbeat\n\tconst tickInterval = setInterval(() => {\n\t\ttick().catch(() => {\n\t\t\t// keep silent; this is a tiny local tracker\n\t\t});\n\t}, 1000);\n\n\t// Sync interval\n\tconst syncInterval = setInterval(() => {\n\t\tperformSync().catch((e) => {\n\t\t\tconsole.error('Sync interval error:', e);\n\t\t});\n\t}, SYNC_INTERVAL_MS);\n\n\tcontext.subscriptions.push({ dispose: () => clearInterval(tickInterval) });\n\tcontext.subscriptions.push({ dispose: () => clearInterval(syncInterval) });\n\tcontext.subscriptions.push(status);\n\n\t// Commands\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand(\"ctc.toggleTracking\", async () => {\n\t\t\tstate.enabled = !state.enabled;\n\t\t\tawait context.globalState.update(STORAGE_KEYS.ENABLED, state.enabled);\n\t\t\tstate.lastTickAt = Date.now(); // prevent counting jump\n\t\t\tsetStatusText();\n\t\t\tvscode.window.showInformationMessage(`Code Time Counter: ${state.enabled ? \"ON\" : \"OFF\"}`);\n\t\t})\n\t);\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand(\"ctc.resetToday\", async () => {\n\t\t\tconst totals = readDailyTotals();\n\t\t\ttotals[dayKey()] = 0;\n\t\t\tawait writeDailyTotals(totals);\n\n\t\t\tconst totalSeconds = readDailyTotalSeconds();\n\t\t\ttotalSeconds[dayKey()] = 0;\n\t\t\tawait writeDailyTotalSeconds(totalSeconds);\n\n\t\t\tconst langTotals = readLanguageTotals();\n\t\t\tlangTotals[dayKey()] = {};\n\t\t\tawait writeLanguageTotals(langTotals);\n\n\t\t\tstate.lastTickAt = Date.now();\n\t\t\tsetStatusText();\n\t\t\tvscode.window.showInformationMessage(\"Code Time Counter: reset today to 00:00:00\");\n\t\t})\n\t);\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand(\"ctc.resetProject\", async () => {\n\t\t\tawait context.workspaceState.update(STORAGE_KEYS.PROJECT, 0);\n\t\t\tstate.lastTickAt = Date.now();\n\t\t\tsetStatusText();\n\t\t\tvscode.window.showInformationMessage(\"Code Time Counter: reset project time to 00:00:00\");\n\t\t})\n\t);\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand(\"ctc.showToday\", async () => {\n\t\t\tconst t = getTodaySeconds();\n\t\t\tconst p = getProjectSeconds();\n\t\t\tconst langTotals = readLanguageTotals();\n\t\t\tconst todayLangs = langTotals[dayKey()] || {};\n\n\t\t\tlet langBreakdown = \"\";\n\t\t\tif (Object.keys(todayLangs).length > 0) {\n\t\t\t\tlangBreakdown = \"\\n\\nLanguage Breakdown:\\n\" +\n\t\t\t\t\tObject.entries(todayLangs)\n\t\t\t\t\t\t.sort((a, b) => b[1] - a[1])\n\t\t\t\t\t\t.map(([lang, secs]) => `  ${lang}: ${formatHMS(secs)}`)\n\t\t\t\t\t\t.join(\"\\n\");\n\t\t\t}\n\n\t\t\tvscode.window.showInformationMessage(`Project: ${formatHMS(p)} | Today: ${formatHMS(t)}${langBreakdown}`);\n\t\t})\n\t);\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand(\"ctc.showUser\", async () => {\n\t\t\tconst user = await ensureAuthenticated();\n\t\t\tif (user) {\n\t\t\t\tconst lastSync = formatLastSync(state.lastSyncAt);\n\t\t\t\tvscode.window.showInformationMessage(\n\t\t\t\t\t`Authenticated as:\\n${user.username}\\n(${user.provider})\\n\\nLast Sync: ${lastSync}`\n\t\t\t\t);\n\t\t\t}\n\t\t})\n\t);\n\n\t// Add manual sync command\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand(\"ctc.syncNow\", async () => {\n\t\t\tconst user = await ensureAuthenticated();\n\t\t\tif (user) {\n\t\t\t\tusername = user.username;\n\t\t\t\tawait context.globalState.update(STORAGE_KEYS.USER_ID, username);\n\n\t\t\t\tvscode.window.showInformationMessage(\"Syncing to Supabase...\");\n\t\t\t\tawait performSync();\n\t\t\t}\n\t\t})\n\t);\n}\n\nexport function deactivate() { }\n"],"names":["SUPABASE_CONFIG","url","anonKey","edgeFunctionName","SYNC_INTERVAL_MS","STORAGE_KEYS","DAILY","DAILY_TOTAL","ENABLED","PROJECT","PENDING_SYNC","LANGUAGE_TOTALS","USER_ID","USER_EMAIL","LAST_SYNC","async","context","username","dailyTotals","globalState","get","payload","buildSyncPayload","data","length","console","log","edgeFunctionUrl","JSON","stringify","response","fetch","method","headers","body","responseText","text","ok","error","status","statusText","Error","result","parse","update","Date","now","vscode","window","showErrorMessage","message","String","timestamp","diff","minutes","Math","floor","dailyTotalSeconds","languageTotals","allDays","Set","Object","keys","day","focusedSeconds","totalSeconds","languageBreakdown","push","source","module","exports","require","user","getAuthenticatedUser","extractUsername","label","includes","split","ghSession","authentication","getSession","createIfNone","id","account","email","provider","e","msSession","googleSession","session","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","createStatusBarItem","StatusBarAlignment","Left","command","tooltip","show","state","enabled","lastTickAt","lastDayKey","dayKey","focused","currentLanguage","activeTextEditor","document","languageId","lastSyncAt","getLastSyncTime","readDailyTotals","writeDailyTotals","totals","readDailyTotalSeconds","writeDailyTotalSeconds","readLanguageTotals","writeLanguageTotals","getTodaySeconds","getProjectSeconds","workspaceState","setStatusText","tProject","tToday","icon","syncIcon","formatHMS","lastSync","formatLastSync","authStatus","performSync","syncToSupabase","subscriptions","onDidChangeActiveTextEditor","editor","onDidChangeWindowState","tickInterval","setInterval","elapsedSec","nowKey","rollDayIfNeeded","seconds","today","addTotalSecondsToToday","addSecondsToToday","current","addSecondsToProject","language","addSecondsToLanguage","tick","catch","syncInterval","dispose","clearInterval","commands","registerCommand","showInformationMessage","langTotals","t","p","todayLangs","langBreakdown","entries","sort","a","b","map","lang","secs","join","ensureAuthenticated","d","getFullYear","getMonth","padStart","getDate","s","max","h","m","ss"],"ignoreList":[],"sourceRoot":""}