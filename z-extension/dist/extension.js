(()=>{"use strict";var t={28(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.STORAGE_KEYS=e.SYNC_INTERVAL_MS=e.SUPABASE_CONFIG=void 0,e.SUPABASE_CONFIG={url:"https://zdofgzagbuyytgnesfgw.supabase.co",anonKey:"sb_publishable_YElI4wwyRFBzjNY_Wt7H-A_HCZqeJrI",edgeFunctionName:"pushToDb"},e.SYNC_INTERVAL_MS=84e4,e.STORAGE_KEYS={DAILY:"ctc.dailyTotals",DAILY_TOTAL:"ctc.dailyTotalSeconds",ENABLED:"ctc.enabled",PROJECT:"ctc.projectTotal",PENDING_SYNC:"ctc.pendingSync",LANGUAGE_TOTALS:"ctc.languageTotals",USER_ID:"ctc.userId",USER_EMAIL:"ctc.userEmail",LAST_SYNC:"ctc.lastSync"}},313(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.buildSyncPayload=s,e.syncToSupabase=async function(t,e){try{const a=t.globalState.get(o.STORAGE_KEYS.DAILY,{}),n=s(e,a,t.globalState.get(o.STORAGE_KEYS.DAILY_TOTAL,{}),t.globalState.get(o.STORAGE_KEYS.LANGUAGE_TOTALS,{}));if(0===n.data.length)return console.log("No data to sync"),!0;const c=`${o.SUPABASE_CONFIG.url}/functions/v1/${o.SUPABASE_CONFIG.edgeFunctionName}`;console.log(`[Sync] Target: ${c}`),console.log(`[Sync] Payload size: ${n.data.length} days for user: ${e}`),console.log(JSON.stringify(n,null,2));const r=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.SUPABASE_CONFIG.anonKey}`},body:JSON.stringify(n)}),i=await r.text();if(!r.ok)throw console.error(`[Sync] Failed: ${r.status} ${r.statusText}`),console.error(`[Sync] Response Body: ${i}`),new Error(`Sync failed: ${r.status} - ${i}`);console.log(`[Sync] Success! Response: ${i}`);const u=JSON.parse(i);return console.log("Sync successful:",u),await t.globalState.update(o.STORAGE_KEYS.LAST_SYNC,Date.now()),!0}catch(t){return console.error("Sync error:",t),n.window.showErrorMessage(`Failed to sync: ${t instanceof Error?t.message:String(t)}`),!1}},e.getLastSyncTime=function(t){return t.globalState.get(o.STORAGE_KEYS.LAST_SYNC,0)},e.formatLastSync=function(t){if(0===t)return"Never";const e=Date.now()-t,a=Math.floor(e/6e4);return a<1?"Just now":a<60?`${a} min ago`:`${Math.floor(a/60)}h ${a%60}m ago`};const n=a(398),o=a(28);function s(t,e,a,n){const o=[],s=new Set([...Object.keys(e),...Object.keys(a)]);for(const t of s){const s=e[t]||0,c=a[t]||0;if(s>0||c>0){const e=n[t]||{};o.push({day:t,focusedSeconds:s,totalSeconds:c,languageBreakdown:e,source:"vscode"})}}return{username:t,data:o}}},398(t){t.exports=require("vscode")},688(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.getAuthenticatedUser=o,e.ensureAuthenticated=async function(){const t=await o();return t||n.window.showErrorMessage('Please sign in to track your coding time. Use Command Palette: "Sign in to sync settings"'),t};const n=a(398);async function o(){try{const t=t=>t.includes("@")?t.split("@")[0]:t;try{const t=await n.authentication.getSession("github",["read:user"],{createIfNone:!1});if(t)return{id:t.account.id,username:t.account.label,email:t.account.label,provider:"github"}}catch(t){console.log("GitHub auth not available")}try{const e=await n.authentication.getSession("microsoft",["User.Read"],{createIfNone:!1});if(e)return{id:e.account.id,username:t(e.account.label),email:e.account.label,provider:"microsoft"}}catch(t){console.log("Microsoft auth not available")}try{const e=await n.authentication.getSession("google",["profile","email"],{createIfNone:!1});if(e)return{id:e.account.id,username:t(e.account.label),email:e.account.label,provider:"google"}}catch(t){console.log("Google auth not available")}const e=await n.authentication.getSession("github",["read:user"],{createIfNone:!0});return e?{id:e.account.id,username:e.account.label,email:e.account.label,provider:"github"}:null}catch(t){return console.error("Error getting authenticated user:",t),n.window.showErrorMessage(`Failed to authenticate: ${t instanceof Error?t.message:String(t)}`),null}}}},e={};function a(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,a),s.exports}var n={};(()=>{var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(t){const a=e.window.createStatusBarItem(e.StatusBarAlignment.Left,100);a.command="ctc.toggleTracking",a.tooltip="Code Time Counter (click to toggle)",a.show();const n={enabled:t.globalState.get(o.STORAGE_KEYS.ENABLED,!0),lastTickAt:Date.now(),lastDayKey:r(),focused:e.window.state.focused,currentLanguage:e.window.activeTextEditor?.document.languageId||null,lastSyncAt:(0,c.getLastSyncTime)(t)};let u=t.globalState.get(o.STORAGE_KEYS.USER_ID)||null;function l(){return t.globalState.get(o.STORAGE_KEYS.DAILY,{})}async function d(e){await t.globalState.update(o.STORAGE_KEYS.DAILY,e)}function S(){return t.globalState.get(o.STORAGE_KEYS.DAILY_TOTAL,{})}async function g(e){await t.globalState.update(o.STORAGE_KEYS.DAILY_TOTAL,e)}function w(){return t.globalState.get(o.STORAGE_KEYS.LANGUAGE_TOTALS,{})}async function y(e){await t.globalState.update(o.STORAGE_KEYS.LANGUAGE_TOTALS,e)}function f(){return l()[r()]??0}function A(){return t.workspaceState.get(o.STORAGE_KEYS.PROJECT,0)}function T(){const t=A(),e=f(),o=n.enabled?"⏱":"⏸",s=u?"☁":"⚠";a.text=`${o} ${i(t)} ${s}`;const r=(0,c.formatLastSync)(n.lastSyncAt),l=u?`Signed in as: ${u}`:"Not signed in";a.tooltip=n.enabled?`Tracking ON (click to pause)\n\nProject Total: ${i(t)}\nToday Total: ${i(e)}\n\n${l}\nLast Sync: ${r}`:`Tracking OFF (click to resume)\n\nProject Total: ${i(t)}\nToday Total: ${i(e)}\n\n${l}\nLast Sync: ${r}`}async function p(){u?await(0,c.syncToSupabase)(t,u)&&(n.lastSyncAt=Date.now(),T()):console.log("Skipping sync: user not authenticated")}(async()=>{const e=await(0,s.getAuthenticatedUser)();e?(u=e.username,await t.globalState.update(o.STORAGE_KEYS.USER_ID,u),console.log(`Authenticated as: ${u} (${e.provider})`),await p()):console.log("User not authenticated - tracking locally only"),T()})(),T(),t.subscriptions.push(e.window.onDidChangeActiveTextEditor(t=>{n.currentLanguage=t?.document.languageId||null})),t.subscriptions.push(e.window.onDidChangeWindowState(t=>{n.focused=t.focused,n.lastTickAt=Date.now(),T()}));const E=setInterval(()=>{(async function(){const e=Date.now(),a=Math.floor((e-n.lastTickAt)/1e3);n.lastTickAt=e,await async function(){const t=r();t!==n.lastDayKey&&(n.lastDayKey=t)}(),n.enabled&&a>0&&(await async function(t){if(t<=0)return;const e=r(),a=S();a[e]=(a[e]??0)+t,await g(a)}(a),n.focused&&(await async function(t){if(t<=0)return;const e=r(),a=l();a[e]=(a[e]??0)+t,await d(a)}(a),await async function(e){if(e<=0)return;const a=A();await t.workspaceState.update(o.STORAGE_KEYS.PROJECT,a+e)}(a),await async function(t,e){if(e<=0||!t)return;const a=r(),n=w();n[a]||(n[a]={}),n[a][t]=(n[a][t]??0)+e,await y(n)}(n.currentLanguage,a))),T()})().catch(()=>{})},1e3),m=setInterval(()=>{p().catch(t=>{console.error("Sync interval error:",t)})},o.SYNC_INTERVAL_MS);t.subscriptions.push({dispose:()=>clearInterval(E)}),t.subscriptions.push({dispose:()=>clearInterval(m)}),t.subscriptions.push(a),t.subscriptions.push(e.commands.registerCommand("ctc.toggleTracking",async()=>{n.enabled=!n.enabled,await t.globalState.update(o.STORAGE_KEYS.ENABLED,n.enabled),n.lastTickAt=Date.now(),T(),e.window.showInformationMessage("Code Time Counter: "+(n.enabled?"ON":"OFF"))})),t.subscriptions.push(e.commands.registerCommand("ctc.resetToday",async()=>{const t=l();t[r()]=0,await d(t);const a=S();a[r()]=0,await g(a);const o=w();o[r()]={},await y(o),n.lastTickAt=Date.now(),T(),e.window.showInformationMessage("Code Time Counter: reset today to 00:00:00")})),t.subscriptions.push(e.commands.registerCommand("ctc.resetProject",async()=>{await t.workspaceState.update(o.STORAGE_KEYS.PROJECT,0),n.lastTickAt=Date.now(),T(),e.window.showInformationMessage("Code Time Counter: reset project time to 00:00:00")})),t.subscriptions.push(e.commands.registerCommand("ctc.showToday",async()=>{const t=f(),a=A(),n=w()[r()]||{};let o="";Object.keys(n).length>0&&(o="\n\nLanguage Breakdown:\n"+Object.entries(n).sort((t,e)=>e[1]-t[1]).map(([t,e])=>`  ${t}: ${i(e)}`).join("\n")),e.window.showInformationMessage(`Project: ${i(a)} | Today: ${i(t)}${o}`)})),t.subscriptions.push(e.commands.registerCommand("ctc.showUser",async()=>{const t=await(0,s.ensureAuthenticated)();if(t){const a=(0,c.formatLastSync)(n.lastSyncAt);e.window.showInformationMessage(`Authenticated as:\n${t.username}\n(${t.provider})\n\nLast Sync: ${a}`)}})),t.subscriptions.push(e.commands.registerCommand("ctc.syncNow",async()=>{const a=await(0,s.ensureAuthenticated)();a&&(u=a.username,await t.globalState.update(o.STORAGE_KEYS.USER_ID,u),e.window.showInformationMessage("Syncing to Supabase..."),await p())}))},t.deactivate=function(){};const e=a(398),o=a(28),s=a(688),c=a(313);function r(t=new Date){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function i(t){const e=Math.max(0,Math.floor(t)),a=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60;return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}:${String(o).padStart(2,"0")}`}})(),module.exports=n})();